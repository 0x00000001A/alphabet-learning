"use strict";var Utils=function(){function t(){}return t.getRandomUpTo=function(t){return Math.floor(Math.random()*t)},t.shuffleArray=function(e){var r,i,s;for(s=e.length-1;s>0;s--)r=t.getRandomUpTo(s+1),i=e[s],e[s]=e[r],e[r]=i},t}(),utils=Utils,AlphabetLetter=function(){function t(t,e){this._id=t,this._score=0,this._origin=e,this._letter=e.letter,this._sentence=e.sentence||"",this._description=e.description,this._transcription=e.transcription||""}return t.prototype={constructor:t,getId:function(){return this._id},getScore:function(){return this._score},addScore:function(){this._score++},reduceScore:function(){this._score--},getLetter:function(){return this._letter},getSentence:function(){return this._sentence},getDescription:function(){return this._description},getTranscription:function(){return this._transcription},toObject:function(){return this._origin}},t}(),alphabetLetter=AlphabetLetter,AlphabetLetterGroup=function(){function t(t,e){this._id=t,this._letters=[],this._lettersCount=0,this._initLetters(e)}return t.prototype={constructor:t,size:function(){return this._lettersCount},getId:function(){return this._id},getLetter:function(t){return this._letters[t]},_addLetter:function(t,e){this._letters[t]=new alphabetLetter(t,e),this._lettersCount++},_initLetters:function(t){for(var e=t.length,r=0;r<e;r++)this._addLetter(r,t[r])}},t}(),alphabetLetterGroup=AlphabetLetterGroup,Alphabet=function(){function t(t){this._groups=[],this._groupsCount=0,this._languageName="",this._languageCode="",this._initGroups(t.groups)}return t.prototype={constructor:t,size:function(){return this._groupsCount},getGroup:function(t){return this._groups[t]},_addGroup:function(t,e){this._groups[t]=new alphabetLetterGroup(t,e),this._groupsCount++},_initGroups:function(t){for(var e=t.length,r=0;r<e;r++)this._addGroup(r,t[r])}},t}(),alphabet=Alphabet,PriorityQueue=function(){function t(t){t||(t=1e3),this._size=0,this._nodes=new Array(t),this._comparator=this._defaultComparator}return t.prototype={constructor:t,size:function(){return this._size},push:function(t){this._nodes[++this._size]=t;for(var e=this._size;e>1&&this.compare(this._nodes[e],this._nodes[e>>1]);e>>=1)this.swap(e,e>>1)},compare:function(t,e){return this._comparator(t,e)},shift:function(){if(0!==this._size)return this.swap(1,this._size),this.rebuild(1),this._nodes[this._size--]},swap:function(t,e){var r=this._nodes[t];this._nodes[t]=this._nodes[e],this._nodes[e]=r},rebuild:function(t){var e=2*t;if(e<this._size){var r=e+1;r<this._size&&this.compare(this._nodes[r],this._nodes[e])&&(e=r),this.compare(this._nodes[e],this._nodes[t])&&(this.swap(t,e),this.rebuild(e))}},setComparator:function(t){this._comparator=t},_defaultComparator:function(t,e){return t<e}},t}(),priorityQueue=PriorityQueue,Quiz=function(){function t(){this._modes=2,this._alphabet=null,this._currentMode=0,this._currentGroup=null,this._currentQuestion=null,this._currentDatabase=null,this._MIN_SCORE_TO_REMEMBER=4,this._MIN_SCORE_TO_ACCEPT_PROGRESS=6}return t.prototype={constructor:t,start:function(t){this._initQuestions(t),this.next()},next:function(t){this._currentQuestion&&(this.isCorrect(t)?this._currentQuestion.addScore():this._currentQuestion.reduceScore()),this._changeGroup(),this._changeQuestion(),this._changeMode()},isCorrect:function(t){var e=this._currentQuestion.getLetter().toLowerCase(),r=this._currentQuestion.getDescription().toLowerCase(),i=t.toLowerCase();return e===i||r===i},getOptions:function(){var t=[];if(0===this._currentMode||1===this._currentMode)for(var e=this._currentGroup.size(),r=0;r<e;r++){var i=this._currentGroup.getLetter(r),s={};0===this._currentMode?(s.text=i.getDescription(),s.additional=i.getTranscription()):s.text=i.getLetter(),t.push(s)}return utils.shuffleArray(t),t},getMessage:function(){var t="";if(this._answerPossiblyRemembered())switch(this._currentMode){case 0:case 1:t="Select one option";break;case 2:t="Type your answer and press Enter"}else switch(this._currentMode){case 0:t=this._currentQuestion.getDescription();break;case 1:t=this._currentQuestion.getLetter()}return t},getSentence:function(){return this._currentQuestion.getSentence()},getQuestion:function(){var t={text:"",original:this._currentQuestion.toObject()};switch(this._currentMode){case 0:case 2:t.text=this._currentQuestion.getLetter();break;case 1:t.text=this._currentQuestion.getDescription()}return t},getProgress:function(){for(var t=0,e=0,r=this._currentDatabase.size(),i=0;i<r;i++)for(var s=this._alphabet.getGroup(i),n=s.size(),o=0;o<n;o++)s.getLetter(o).getScore()>this._MIN_SCORE_TO_ACCEPT_PROGRESS&&e++,t++;var u=e/t*100;return isNaN(u)?0:u},setMinScoreToRememember:function(t){t>0&&(this._MIN_SCORE_TO_REMEMBER=t)},_initQuestions:function(t){this._alphabet=new alphabet(t),this._currentDatabase=new priorityQueue(this._alphabet.size()),this._currentDatabase.setComparator(function(t,e){for(var r=0,i=0,s=t.size(),n=e.size(),o=Math.min(s,n),u=0;u<o;u++)r+=t.getLetter(u).getScore(),i+=e.getLetter(u).getScore();return r<i}),this._currentDatabase.push(this._alphabet.getGroup(0))},_changeMode:function(){this._currentQuestion&&this._answerPossiblyRemembered()?2===this._currentMode?this._currentMode=0:this._currentMode=utils.getRandomUpTo(this._modes+1):this._currentMode=0},_changeGroup:function(){var t;this._currentGroup&&this._currentDatabase.push(this._currentGroup);for(var e=[],r=0;r<2;r++){var i=this._currentDatabase.shift();i&&e.push(i),t||(t=i)}utils.shuffleArray(e),this._currentGroup=e.shift();var s=e.length;for(r=0;r<s;r++)this._currentDatabase.push(e[r]);this._increaseDifficultyIfNeeded(t)},_changeQuestion:function(){this._currentQuestion=this._currentGroup.getLetter(utils.getRandomUpTo(this._currentGroup.size()))},_increaseDifficultyIfNeeded:function(t){for(var e=t.size(),r=0;r<e;r++)if(t.getLetter(r).getScore()<this._MIN_SCORE_TO_REMEMBER)return;this._currentDatabase.push(this._alphabet.getGroup(this._currentDatabase.size()))},_answerPossiblyRemembered:function(){return this._currentQuestion.getScore()>this._MIN_SCORE_TO_REMEMBER}},t}(),src=Quiz;module.exports=src;
